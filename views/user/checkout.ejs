<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Male_Fashion Template">
    <meta name="keywords" content="Male_Fashion, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Bodyfit | Template</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
    rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="/public/bodyfitHome/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="/public/bodyfitHome/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/public/bodyfitHome/css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="/public/bodyfitHome/css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="/public/bodyfitHome/css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="/public/bodyfitHome/css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="/public/bodyfitHome/css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="/public/bodyfitHome/css/style.css" type="text/css">
</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>


        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-3">
                    <div class="header__logo">
                        <a href="./index.html"><img src="/public/bodyfitHome/img/logo.png" alt=""></a>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <nav class="header__menu mobile-menu">
                        <ul>
                            <li class="active"><a href="/">Home</a></li>
                            <li><a href="/shop">Shop</a></li>
                            <li><a href="#">my account</a>
                                <ul class="dropdown">
                                    <li><a href="/viewProfile">profile</a></li>
                                    <li><a href="/order-list">Order Details</a></li>
                                    <li><a href="/signup">Signup</a></li>
                                    <li><a href="/login">Login</a></li>
                                    <li><a href="/logout">Logout</a></li>
                                </ul>
                            </li>
                           
                            <!-- <li><a href="/login">Login</a></li>
                            <li><a href="/logout">Logout</a></li> -->
                        </ul>
                    </nav>
                </div>
                <div class="col-lg-3 col-md-3">
                    <div class="header__nav__option">
                        <a href="#" class="search-switch"><img src="/public/bodyfitHome/img/icon/search.png" alt=""></a>
                        <a href="/viewWishlist"><img src="/public/bodyfitHome/img/icon/heart.png" alt=""></a>
                        <a href="/cart"><img src="/public/bodyfitHome/img/icon/cart.png" alt=""> <span>0</span></a>
                        <div class="price">$0.00</div>
                    </div>
                </div>
            </div>
            <div class="canvas__open"><i class="fa fa-bars"></i></div>
        </div>
    </header>
    <!-- Header Section End -->

     <!-- Breadcrumb Section Begin -->
     <section class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__text">
                        <h4>Check Out</h4>
                        <div class="breadcrumb__links">
                            <a href="./index.html">Home</a>
                            <a href="./shop.html">Shop</a>
                            <span>Check Out</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->

    <!-- Checkout Section Begin -->
   
      
    <section class="checkout spad">
        <div class="container">
            <div class="checkout__form">
                <div class="col-12" id="selectedAddressDetails">

                    <div class="select_form_select default-form-box">
                        <label for="countru_name">Your Address </label>
                        <select class="niceselect_option wide" name="cuntry" id="countru_name"
                            onchange="updateAddressDetails(this.value)" >
                            <option value="2">Select Your Address</option>
                            <% if (userData.addressDetails && userData.addressDetails.length> 0) { %>
                                <% for (let i=0; i < userData.addressDetails.length; i++) { %>

                                    <option value="<%= userData.addressDetails[i]._id %>">
                                        <%= userData.addressDetails[i].Fullname %>
                                            <%= userData.addressDetails[i].houseaddress %>
                                    </option>

                                    <% } %>
                                        <% } else { %>
                                            <p>No address selected</p>
                                            <% } %>
                        </select>
                    </div>
                  </div>
              
                    <div class="row">
                        

                        <div class="col-lg-8 col-md-6">
                            <h6 class="coupon__code"><span class="icon_tag_alt"></span>  <a href="#">Click
                            here</a> </h6>
                            <h6 class="checkout__title">Billing Details</h6>


                            <div class="checkout__input">
                                <p>Fullname<span>*</span></p>
                                <input type="text"  id="name" name="name" value="">
                              

                            </div>
                     

                            <div class="checkout__input">
                                <p>Company/Shop<span>*</span></p>
                                <input id="shop" name="shop" type="text">
                            </div>

                            <div class="checkout__input">
                                <p>Street Address<span>*</span></p>
                                <input name="street" id="street" type="text"  required>
                            

                            </div>
                            <div class="checkout__input">
                                <p> Postal Code/ZIP<span>*</span></p>
                                <input type="number" id="code" name="code" required>
                              

                     
                            </div>
                            <div class="checkout__input">
                                <p>Town/City<span>*</span></p>
                                <input type="text" id="city" placeholder="city" name="city" required>
                            

                            </div>
                            <div class="checkout__input">
                                <p>State<span>*</span></p>
                                <input id="state" name="state" type="text" required>
                     

                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="checkout__input">
                                        <p>Phone<span>*</span></p>
                                        <input type="number" id="mobile" name="mobile" required>
                        

                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="checkout__input">
                                        <p>Email<span>*</span></p>
                                        <input type="email" name="email" id="email" required>
                                    

                                    </div>
                                </div>
                            </div>
                        
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="checkout__order">
                                <h4 class="order__title">Your order</h4>


                                <div class="checkout__order__products">Product <span>Total</span></div>

                                <ul class="checkout__total__products">
                                 <% var totalAmount=0 %>
                                 <% var totalprice=0 %>

                                 <% cartList.forEach((item,index)=>{%>
                                 <li><%= index+1%> <%=item.product.productname%> <span> <%=item.product.price%></span></li>
                                  <% totalprice=item.cartItems.qty * item.product.price %>
                                  <% totalAmount +=totalprice %>  
                                 <%})%>

                                 <li>Subtotal <span><%= totalprice%></span></li>
                                 <li>Total <span id="totalAmount"><%= totalAmount%></span></li>
                                    </ul>   

                                   
                             
                                 <p>Lorem ipsum dolor sit amet, consectetur adip elit, sed do eiusmod tempor incididunt
                                 ut labore et dolore magna aliqua.</p>
                                 <!-- <div class="">
                                    <label class="radio-default" for="currencyCod" data-bs-toggle="collapse"
                                        data-bs-target="#methodCod">
                                        <input type="radio"  name="payment" value="cod" id="payment" >
                                        <span>Cash on Delivery</span>
                                    </label>


                                    <label class="radio-default" for="currencyCod" data-bs-toggle="collapse"
                                        data-bs-target="#methodCod">
                                        <input type="radio" name="payment" value="online" id="payment">
                                        <span>Online Payment</span>
                                    </label>

                                 </div> -->

                                 <div class="payment_method">
                                    <div class="panel-default">
        
        
                                        <button class="btn btn-primary btn-sm btn-block my-2" onclick="cashOnDelivary('<%= userId %>')">Chash On
                                            delivary</button>
        
                                    
                                        <button type="submit" onclick="onlinePayment('<%= userId %>')" class="btn btn-danger btn-sm btn-block my-2"  id="rzp-button1">Online Payment</button>
                                    
        
        
        
                                    
                                    </div>
                                 </div>

                  
                            </div>
                        </div>
                    </div>
             
            </div>
        </div>
    </section>
    <!-- Checkout Section End -->
    <!-- Footer Section Begin -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="footer__about">
                        <div class="footer__logo">
                            <a href="#"><h3 style="color: white;">BODYFIT</h3></a>
                        </div>
                        <p>The customer is at the heart of our unique business model, which includes design.</p>
                        <a href="#"><img src="/public/bodyfitHome/img/payment.png" alt=""></a>
                    </div>
                </div>
                <div class="col-lg-2 offset-lg-1 col-md-3 col-sm-6">
                    <div class="footer__widget">
                        <h6>MENU</h6>
                        <ul>
                            <li><a href="#">Home</a></li>
                            <li><a href="#">Catalog</a></li>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Profile</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6">
                    <div class="footer__widget">
                        <h6>HELP                        </h6>
                        <ul>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Payment Methods</a></li>
                            <li><a href="#">Delivary</a></li>
                            <li><a href="#">Return & Exchanges</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6">
                    <div class="footer__widget">
                        <h6>Contact Us                      </h6>
                        <ul>
                            <li><a href="#">	HiLight business Park , calicut ,kerala</a></li>
                            <li><a href="#">	6238424753</a></li>
                            <li><a href="#">	shoehub2023@gmail.com</a></li>
                           
                        </ul>
                    </div>
                </div>
             
            </div>
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="footer__copyright__text">
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                        <p>Copyright Â©
                            <script>
                                document.write(new Date().getFullYear());
                            </script>2020
                            All rights reserved | This template is made with <i class="fa fa-heart-o"
                            aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Abhijith</a>
                        </p>
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->
    <!-- Search Begin -->
    <div class="search-model">
        <div class="h-100 d-flex align-items-center justify-content-center">
            <div class="search-close-switch">+</div>
            <form class="search-model-form">
                <input type="text" id="search-input" placeholder="Search here.....">
            </form>
        </div>
    </div>
    <!-- Search End -->

    <!-- Js Plugins -->

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>




    <script>
        async function updateAddressDetails(addressId) {
            const res = await fetch('/getAddressDetails/'+addressId);
            const data = await res.json();
            console.log('Data retrieved from the server:', data);
            if(data.message==='Address not found'){
                document.querySelector('#name').value = "";
                document.querySelector('#shop').value = "";
                document.querySelector('#state').value = "";
                document.querySelector('#city').value = "";
                document.querySelector('#street').value = "";  
                document.querySelector('#email').value = "";
                document.querySelector('#country').value = "";
                document.getElementById('#mobile').value = "";
                document.querySelector('#code').value = "";
            }else{
                document.querySelector('#name').value = data.Fullname;
                document.querySelector('#shop').value = data.company;
                document.querySelector('#state').value = data.state;
                document.querySelector('#city').value = data.city;
                document.querySelector('#street').value = data.houseaddress;
                document.querySelector('#code').value = data.postal_code;
                document.querySelector('#email').value = data.email;
                document.getElementById('mobile').value = data.mobile;
            }
        }
        </script>

<script>
    function cashOnDelivary(userId){
  const amount = document.querySelector("#totalAmount").innerText;
  const name = document.querySelector("#name").value;
  const shop = document.querySelector("#shop").value;
  const state = document.querySelector("#state").value;
  const city = document.querySelector("#city").value;
  const street = document.querySelector("#street").value;
  const code = document.querySelector("#code").value;
  const email = document.querySelector("#email").value;
  const mobile = document.getElementById("mobile").value;

  const url = window.location.origin;
  console.log(url);


  if (!name || !shop || !state || !city || !street || !code || !email || !mobile) {
    swal({
      title: "Error",
      text: "Please fill in all required fields",
      icon: "error",
      button: "Okay",
    });
    return;
  }

  // Validate email address
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    swal({
      title: "Error",
      text: "Please enter a valid email address",
      icon: "error",
      button: "Okay",
    });
    return;
  }

  // Validate mobile number
  const mobileRegex = /^\d{10}$/;
  if (!mobileRegex.test(mobile)) {
    swal({
      title: "Error",
      text: "Please enter a valid 10-digit mobile number",
      icon: "error",
      button: "Okay",
    });
    return;
  }





  fetch(`${url}/cashon-delivery?userId=${userId}`, {
      method: 'POST',
      headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
      },
      body: JSON.stringify({

        amount,name,shop,state,city,street,code,email,mobile
     
      })
  })
      .then((response) => {
      if (response.ok) {
          return response.json();
      }
      throw new Error('Network response was not ok');
      })
      .then((data) => {
      console.log(data, 'This is data');
      swal({
          title: "Order Placed Successfully!",
          text: `Your order has been placed successfully! Your order id is ${data.orderId}`,
          icon: "success",
          button: "Okay",
      })
          .then(() => {
              window.location.href = `/order-list`;
          });
          setTimeout(() => {
              window.location.href = `/order-list`;
          }, 3000);
      })
      .catch((error) => {
      console.error(`There was a problem with the fetch operation: ${error.message}`);
      // Show error modal
      swal({
          title: "Error",
          text: "There was an error placing your order. Please fill the form.",
          icon: "error",
          button: "Okay",
      });
      });
}

</script>

<script>

    

function onlinePayment(userId) {

  const amount = document.querySelector("#totalAmount").innerText;
  console.log(amount);
  const name = document.querySelector("#name").value;
  const shop = document.querySelector("#shop").value;
  const state = document.querySelector("#state").value;
  const city = document.querySelector("#city").value;
  const street = document.querySelector("#street").value;
  const code = document.querySelector("#code").value;
  const email = document.querySelector("#email").value;
  const mobile = document.getElementById("mobile").value


  if (!name || !shop || !state || !city || !street || !code || !email || !mobile) {
    swal({
      title: "Error",
      text: "Please fill in all required fields",
      icon: "error",
      button: "Okay",
    });
    return;
  }

  // Validate email address
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    swal({
      title: "Error",
      text: "Please enter a valid email address",
      icon: "error",
      button: "Okay",
    });
    return;
  }

  // Validate mobile number
  const mobileRegex = /^\d{10}$/;
  if (!mobileRegex.test(mobile)) {
    swal({
      title: "Error",
      text: "Please enter a valid 10-digit mobile number",
      icon: "error",
      button: "Okay",
    });
    return;
  }





  fetch("/order", {
    method: "post",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      amount,
    }),
  })
    .then((res) => res.json())
    .then((res) => {
      console.log(res);
      var options = {
        key: "rzp_test_jbSlDDRu4vCwER", // Enter the Key ID generated from the Dashboard
        name: "Test Company",
        amount: res.order.amount,
        order_id: res.order.id, // For one time payment
        handler: function (response) {
          console.log(response);


          fetch("/confirm-order", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              name,
              shop,
              state,
              city,
              street,
              code,
              email,
              mobile,
              userId,
              
              response,
            }),
          })
            .then(() => {
              console.log("Order confirmation successful");
              // Show a sweet alert upon successful payment
              swal({
                title: "Payment Successful",
                text: "Thank you for your purchase.",
                icon: "success",
              }).then(() => {
                window.location.href = "/order-list";
              });
            })
            .catch((error) => {
              console.error("Error while confirming order:", error);
            });
        },
      };

      
      var rzp1 = new Razorpay(options);
      rzp1.on("payment.failed", function (response) {
        swal({
          title: "Payment Failed",
          text: response.error.description,
          icon: "error",
        });
        console.log(response.error);
      });
      rzp1.open();
    })
    .catch((error) => {
      console.error("Error while fetching order:", error);
    });
}

</script>
<script>
    function addressValidation() {
     
      
      if (y) {
        alert('Please fill form');
        fileInput.value = '';
        return false;
      }
    }</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>

        
   
    <script src="/public/bodyfitHome/js/jquery-3.3.1.min.js"></script>
    <script src="/public/bodyfitHome/js/bootstrap.min.js"></script>
    <script src="/public/bodyfitHome/js/jquery.nice-select.min.js"></script>
    <script src="/public/bodyfitHome/js/jquery.nicescroll.min.js"></script>
    <script src="/public/bodyfitHome/js/jquery.magnific-popup.min.js"></script>
    <script src="/public/bodyfitHome/js/jquery.countdown.min.js"></script>
    <script src="/public/bodyfitHome/js/jquery.slicknav.js"></script>
    <script src="/public/bodyfitHome/js/mixitup.min.js"></script>
    <script src="/public/bodyfitHome/js/owl.carousel.min.js"></script>
    <script src="/public/bodyfitHome/js/main.js"></script>
</body>

</html>